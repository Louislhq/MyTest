<!DOCTYPE HTML>
<html lang="zh-lang">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>注册登录</title>
    <link rel="stylesheet" type="text/css" href="/wap/dest/css/styles.css?v=222" media="all"/>
	<script src="/wap/dest/js/all.js"></script>
</head>
<body>
	<div class="lt-box">
		<header>请输入您的手机号码,一键完成注册和登录</header>
			<form class="login">
				<div class="mod-input">
					<div class="input-row">
						<input  type="text" class="input-clear" placeholder="请输入您的手机号码">
					</div>
					<div class="input-row">
						<input  type="number" placeholder="请输入验证码">
						<div class="auth">
							<span>获取验证码</span>
						</div>
					</div>
				</div>
			</form>
			<div class="btn">
				<span class="ui-btn ui-btn-disable">立即注册</span>
			</div>
	</div>

	<script type="text/javascript">
		window.onload = function(){
			var inputClear = document.querySelector(".input-clear");
			var auth = document.querySelector(".auth");
			var input = document.getElementsByTagName('input');
			var btnDiv = document.querySelector(".btn");
			var btnDisable = btnDiv.querySelector(".ui-btn-disable");
			var btnReg = btnDiv.querySelector('.ui-btn');
			var state = true;
		
			//获取输入框的值
			var inputValue = inputClear.value;
			var authValue = input[1].value;

			//创建清除图标
			var iconClear = document.createElement('i');
			iconClear.className = 'iconfont' ;
			iconClear.className = iconClear.className + ' ' + 'iconclear';
			
			//输入手机号码，显示清除图标
			inputClear.addEventListener("input" , function(){
				inputClear.parentNode.appendChild(iconClear);
				inputValue = inputClear.value;
				if (!inputValue) {
					this.parentNode.removeChild(iconClear);
				}
			});

			inputClear.addEventListener("focus", function(){
				if (inputValue) {
					inputClear.parentNode.appendChild(iconClear);
				}
			})
			inputClear.addEventListener("blur", function(){
				if (inputValue) {
					this.parentNode.removeChild(iconClear);
				}
			})

			//输入验证码
			input[1].addEventListener("input" , function(){
				authValue = input[1].value;
			})

			//清空输入框
			iconClear.addEventListener("touchend", function(){
				inputClear.value = "";
				inputValue = inputClear.value;
				this.parentNode.removeChild(iconClear);
				btnReg.className = btnReg.className + ' ' + 'ui-btn-disable';
			})

			//判断是否都输入
			document.addEventListener("input" , function(){
				if (inputValue && authValue) {
					btnReg.className ='ui-btn';
					state = false;
				} else if ((!inputValue || !authValue) && !state) {
					btnReg.className = btnReg.className + ' ' + 'ui-btn-disable';
					state = true;
				}
			});

			//判断手机号码
			function checkPhone(){
				var phone = inputValue;
				if ( phone && !(/^1[3|4|5|7|8]\d{9}$/.test(phone))) {
					swal({
						title: "手机号码有误，请重填",
						confirmButtonText:'知道了'
					}); 
					return false;
				}else if (!phone) {
					swal({
						title: "请输入您的手机号码",
						confirmButtonText:'知道了'
					});
					return false;
				}else {
					return true;
				}
			}

			//获取验证码
			auth.addEventListener("touchend", function(e){
				e.preventDefault();
				var result = checkPhone();
				var count = 36;
				var timers = document.createElement('span');
				timers.innerHTML = count + "s后重新发送";
				if (!result) {
					return false;
				}else {
					auth.insertBefore(timers,auth.firstChild);
				auth.className = auth.className + " " + "disable";

				//创建倒数器			
				var run = setInterval(function(){
					count --;
					timers.innerHTML = count + "s后重新发送";
					if (count < 0) {
						clearInterval(run);
						auth.removeChild(timers);
						auth.className = "auth";						
					}
				},1000);
				}	
			});

			btnReg.addEventListener("touchend" , function(e){
				if (btnReg.getAttribute("class") == "ui-btn") {
					window.location.href="verify.html";
				}
			},false);
		}
	</script>
</body>
</html>